(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{133:function(e,t,n){e.exports=n(377)},138:function(e,t,n){},374:function(e,t,n){},377:function(e,t,n){"use strict";n.r(t);var s=n(0),o=n.n(s),a=n(14),i=n.n(a),r=n(132),l=(n(138),n(4)),u=n(3),c=n(6),d=n(5),h=n(7),f=n(1),v=n(25),m=function(){function e(t){Object(l.a)(this,e),this.onConnected=this.onConnected.bind(this),this.onDisconnected=this.onDisconnected.bind(this),this.beforeRequest=this.beforeRequest.bind(this),this.afterResponse=this.afterResponse.bind(this),this.onError=this.onError.bind(this),this.listener={onConnected:this.onConnected,onDisconnected:this.onDisconnected,beforeRequest:this.beforeRequest,afterResponse:this.afterResponse,onError:this.onError},this.wsClient=this.createWebSocketClient(t,this.listener),this.registeredListeners=[],this.registeredChangeListeners={}}return Object(u.a)(e,[{key:"call",value:function(e,t,n){this.wsClient.sendRequest(e,function(e){t(e)})}},{key:"isBusy",value:function(){return!this.isReady}},{key:"isReady",value:function(){return this.wsClient.isReady()}},{key:"addListener",value:function(e){this.registeredListeners.push(e)}},{key:"removeListener",value:function(e){for(var t=0;t<this.registeredListeners.length;t++)if(this.registeredListeners[t]===e){this.registeredListeners.splice(t,1);break}}},{key:"clearListeners",value:function(){this.registeredListeners=[]}},{key:"addChangeListener",value:function(e,t){this.registeredChangeListeners.hasOwnProperty(e)||(this.registeredChangeListeners[e]=[]),this.registeredChangeListeners[e].push(t)}},{key:"removeChangeListener",value:function(e,t){if(this.registeredChangeListeners.hasOwnProperty(e))for(var n=this.registeredChangeListeners[e],s=0;s<n.length;s++)if(n[s]===t){n.splice(s,1);break}}},{key:"clearChangeListeners",value:function(){this.registeredChangeListeners={}}},{key:"onConnected",value:function(){console.log("listener: onConnected"),this.registeredListeners.forEach(function(e){return e.onConnected()})}},{key:"onDisconnected",value:function(){console.log("listener: onDisconnected"),this.registeredListeners.forEach(function(e){return e.onDisconnected()})}},{key:"beforeRequest",value:function(e){this.registeredListeners.forEach(function(t){return t.beforeRequest(e)})}},{key:"afterResponse",value:function(e){if(this.registeredListeners.forEach(function(t){return t.afterResponse(e)}),e.hasOwnProperty("changes"))for(var t=0;t<e.changes.actions.length;t++){var n=e.changes.actions[t];for(var s in n)if(n.hasOwnProperty(s)){var o=this.registeredChangeListeners[s];if("undefined"!==typeof o&&Array.isArray(o))for(var a=0;a<o.length;a++)o[a](n[s])}}}},{key:"onError",value:function(e){console.log("listener: onError",e),this.registeredListeners.forEach(function(t){t.onError(e)})}},{key:"addChart",value:function(e,t,n){this.wsClient.send({addChart:{sheetName:e,chart:t}},n)}},{key:"addSheet",value:function(e,t){this.wsClient.send({addSheet:{sheetName:e}},t)}},{key:"addTable",value:function(e,t,n){this.wsClient.send({addTable:{sheetName:e,table:{name:t}}},n)}},{key:"addText",value:function(e,t,n,s){var o={name:t};n&&(o.content=v.h.formula(n).toObject()),this.wsClient.send({addText:{sheetName:e,text:o}},s)}},{key:"automateTableByQuery",value:function(e,t,n,s){var o=n;this.wsClient.send({automateTable:{sheetName:e,tableName:t,automaton:{queryAutomaton:{template:o}}}},s)}},{key:"automateTableByPivot",value:function(e,t,n,s){var o={sheetName:e,tableName:t,automaton:{pivotAutomaton:n}};this.wsClient.send({automateTable:o},s)}},{key:"setCellValue",value:function(e,t,n,s,o,a){var i={sheetName:e,tableName:t,rowIndex:n,columnIndex:s,value:o};this.wsClient.send({setCellValue:i},a)}},{key:"setCellFormula",value:function(e,t,n,s,o,a){var i={sheetName:e,tableName:t,rowIndex:n,columnIndex:s,formulaString:o};this.wsClient.send({setCellFormula:i},a)}},{key:"refreshCellValue",value:function(e,t,n,s,o,a){var i={sheetName:e,tableName:t,rowIndex:n,columnIndex:s,value:o};this.wsClient.send({refreshCellValue:i},a)}},{key:"chartConsult",value:function(e,t,n,s,o,a,i,r){var l={sheetName:e,tableName:t,type:n,left:s,top:o,right:a,bottom:i};this.wsClient.send({chartConsult:l},r)}},{key:"eraseColumns",value:function(e,t,n,s,o){var a={sheetName:e,tableName:t,columnIndex:n,nColumns:s};this.wsClient.send({eraseColumns:a},o)}},{key:"eraseRows",value:function(e,t,n,s,o){var a={sheetName:e,tableName:t,rowIndex:n,nRows:s};this.wsClient.send({eraseRows:a},o)}},{key:"fillUp",value:function(e,t,n,s,o,a,i){var r={sheetName:e,tableName:t,rowIndex:n,firstColumn:s,lastColumn:o,nRows:a};this.wsClient.send({fillUp:r},i)}},{key:"fillRight",value:function(e,t,n,s,o,a,i){var r={sheetName:e,tableName:t,columnIndex:n,firstRow:s,lastRow:o,nColumns:a};this.wsClient.send({fillRight:r},i)}},{key:"fillDown",value:function(e,t,n,s,o,a,i){var r={sheetName:e,tableName:t,rowIndex:n,firstColumn:s,lastColumn:o,nRows:a};this.wsClient.send({fillDown:r},i)}},{key:"fillLeft",value:function(e,t,n,s,o,a,i){var r={sheetName:e,tableName:t,columnIndex:n,firstRow:s,lastRow:o,nColumns:a};this.wsClient.send({fillLeft:r},i)}},{key:"insertColumns",value:function(e,t,n,s,o){var a={sheetName:e,tableName:t,columnIndex:n,nColumns:s};this.wsClient.send({insertColumns:a},o)}},{key:"insertRows",value:function(e,t,n,s,o){var a={sheetName:e,tableName:t,rowIndex:n,nRows:s};this.wsClient.send({insertRows:a},o)}},{key:"moveSheet",value:function(e,t,n){var s={sheetName:e,targetIndex:t};this.wsClient.send({moveSheet:s},n)}},{key:"removeAsset",value:function(e,t,n){var s={sheetName:e,assetName:t};this.wsClient.send({removeAsset:s},n)}},{key:"removeColumns",value:function(e,t,n,s,o){var a={sheetName:e,tableName:t,columnIndex:n,nColumns:s};this.wsClient.send({removeColumns:a},o)}},{key:"removeRows",value:function(e,t,n,s,o){var a={sheetName:e,tableName:t,rowIndex:n,nRows:s};this.wsClient.send({removeRows:a},o)}},{key:"removeSheet",value:function(e,t){var n={sheetName:e};this.wsClient.send({removeSheet:n},t)}},{key:"renameAsset",value:function(e,t,n,s){var o={sheetName:e,oldAssetName:t,newAssetName:n};this.wsClient.send({renameAsset:o},s)}},{key:"renameSheet",value:function(e,t,n){var s={oldSheetName:e,newSheetName:t};this.wsClient.send({renameSheet:s},n)}},{key:"updateAutomaton",value:function(e){this.wsClient.send({},e)}},{key:"updateChart",value:function(e,t,n){var s={sheetName:e,chart:t};this.wsClient.send({updateChart:s},n)}},{key:"createWorkbook",value:function(e,t){var n={pathname:e};this.wsClient.send({createWorkbook:n},t)}},{key:"openWorkbook",value:function(e,t){var n={pathname:e};this.wsClient.send({openWorkbook:n},t)}},{key:"saveWorkbook",value:function(e){this.wsClient.send({saveWorkbook:{}},e)}},{key:"closeWorkbook",value:function(e){this.wsClient.send({closeWorkbook:{}},e)}},{key:"layoutAsset",value:function(e,t,n,s){var o={sheetName:e,assetName:t,layout:n};this.wsClient.send({layoutAsset:o},s)}},{key:"updateText",value:function(e,t,n,s){var o={name:t};n&&(o.content=n);var a={sheetName:e,text:o};this.wsClient.send({updateText:a},s)}},{key:"executeQuery",value:function(e,t,n,s){var o={sheetName:e,tableName:t,params:n};this.wsClient.send({executeQuery:o},s)}},{key:"createWebSocketClient",value:function(e,t){var n,s,o=!1,a=1,i={};(n=new WebSocket(e)).onopen=function(e){o=!0,s=setInterval(r,15e3),l(e)},n.onclose=function(e){o=!1,clearInterval(s),u(e)},n.onmessage=function(e){c(e)},n.onerror=function(e){d(e)};var r=function(){h()&&(i["txid-0"]=function(){},n.send("{txId:0}"))},l=function(e){console.log("Connected."),"undefined"!==typeof t&&"function"===typeof t.onConnected&&t.onConnected()},u=function(e){console.log("Connection closed."),"undefined"!==typeof t&&"function"===typeof t.onDisconnected&&t.onDisconnected()},c=function(e){var n=JSON.parse(e.data);console.log("onMessage",n);var s="txid-"+n.txId,o=i[s];"function"===typeof o?(o(n),delete i[s]):console.log("WARN: msgCallback not defined!"),"undefined"!==typeof t&&"function"===typeof t.afterResponse&&t.afterResponse(n)},d=function(e){console.log("WebSocket error occurred."),i={},"undefined"!==typeof t&&"function"===typeof t.onError&&t.onError("WebSocket error!")},h=function(){return n&&o};return{isReady:h,send:function(e,s){if(!h())throw new Error("WebSocket not ready.");var o=a++,r={txId:o,action:e};"function"===typeof s&&(i["txid-"+o]=s),"undefined"!==typeof t&&"function"===typeof t.beforeRequest&&t.beforeRequest(o),n.send(JSON.stringify(r))},sendRequest:function(e,s){if(!h())throw new Error("WebSocket not ready.");"function"===typeof s&&(i["txid-"+e.txId]=s),"undefined"!==typeof t&&"function"===typeof t.beforeRequest&&t.beforeRequest(e.txId),n.send(JSON.stringify(e))}}}}],[{key:"errorName",value:function(e){return["#OK!","#UNKNOWN!","#REF!","#VALUE!","#DIV/0!"][e]}},{key:"orientationName",value:function(e){return["UNSET","HORIZONTAL","VERTICAL"][e]}},{key:"placementName",value:function(e){return["UNSET","LEFT","TOP","RIGHT","BOTTOM","CENTER"][e]}}]),e}(),k=(n(373),n(374),function(e){function t(e){var n;return Object(l.a)(this,t),(n=Object(c.a)(this,Object(d.a)(t).call(this,e))).state={presentation:!1},n.service=new m(n.props.wsUri),n.setEditMode=n.setEditMode.bind(Object(f.a)(Object(f.a)(n))),n.setPresentationMode=n.setPresentationMode.bind(Object(f.a)(Object(f.a)(n))),n}return Object(h.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){this.openWorkbookAfterServiceReady()}},{key:"openWorkbookAfterServiceReady",value:function(){var e=this;this.service.isReady()?this.openWorkbook():setTimeout(function(){return e.openWorkbookAfterServiceReady()},100)}},{key:"openWorkbook",value:function(){var e=this,t=new v.a;t.openWorkbook=new v.k,this.service.call({txId:0,action:t},function(t){console.log("open workbook",t),0===t.statusCode&&e.setState({workbook:v.i.deserialize(t.workbook)})})}},{key:"setEditMode",value:function(){this.setState({presentation:!1})}},{key:"setPresentationMode",value:function(){this.setState({presentation:!0})}},{key:"render",value:function(){return o.a.createElement("div",{className:"wrapper"},o.a.createElement("div",{className:"header"},o.a.createElement("ul",null,o.a.createElement("li",{className:this.state.presentation?"":"selected"},o.a.createElement("a",{href:"javascript:void(0);",onClick:this.setEditMode},"\u7f16\u8f91\u6a21\u5f0f")),o.a.createElement("li",{className:this.state.presentation?"selected":""},o.a.createElement("a",{href:"javascript:void(0);",onClick:this.setPresentationMode},"\u5c55\u793a\u6a21\u5f0f")))),o.a.createElement("div",{className:"content"},this.renderContent()))}},{key:"renderContent",value:function(){var e=this.state.workbook;return"undefined"!==typeof e?this.state.presentation?o.a.createElement(v.l,{workbook:e,service:this.service}):o.a.createElement(v.j,{workbook:e,service:this.service}):o.a.createElement("div",{className:"loading"},"Loading...")}}]),t}(s.Component));k.defaultProps={wsUri:"ws://"+window.location.host+"/wsapi"};var y=k;i.a.render(o.a.createElement(r.a,null,o.a.createElement(y,null)),document.getElementById("root"))}},[[133,1,2]]]);
//# sourceMappingURL=main.75b89a15.chunk.js.map